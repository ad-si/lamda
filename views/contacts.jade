extends ../linked_modules/lamda-views/layout

block styles
	link(rel='stylesheet', href='#{baseURL}/styles/flags16.css')
	link(rel='stylesheet', href='#{baseURL}/styles/index.css')

block content
	p#summary You have #{contacts.length} contacts. (#{percentageOfMale}% Male)
	a#export.button(href='#{baseURL}/export?format=csv') Export as CSV
	br
	if errors.length > 0
		.errors
			for error in errors
				.alert-danger= error.message
	table
		thead
			tr
				// Print available keys in a sorted order
				each key in sortedKeys
					if availableKeys.indexOf(key) !== -1
						if key !== 'gender'
							th= key.toUpperCase()
		tbody
			for contact in contacts
				if contact
					tr(class = contact.gender)
						for key in sortedKeys
							if Object.keys(contact).indexOf(key) !== -1
								- var value = contact[key]
								- var title = (typeof value == 'string') ? value : null
								td(
									class = key
									title = title
								)
									if key === 'name'
										- var nickname = contact.nickname
										= value + ' '
										if nickname
											small= '(' + nickname + ')'

									else if key === 'website'
										- value = value.replace(/https?:\/\//, '')
										- value = value.replace(/www\./, '')
										a(href='http://' + value, target='_blank')
											= value

									else if key === 'phones'
										if contact.phones.length === 0
											a(href='tel:' + value)= value
										else
											ul
												for phone in contact.phones
													li: a(href='tel:' + phone.number)= phone.number

									else if key === 'facebook'
										a(href='https://facebook.com/' + value, , target='_blank')
											= value

									else if key === 'emails'
										ul
											for email in contact.emails
												- var provider = email.value.split('@')[1].split('.')
												- Array.isArray(provider) ? provider.pop() : ''
												li: a(
													href="mailto:#{email.value}"
													target='_blank'
													class="provider #{provider.pop()}"
												)
													= email.value

									else if key === 'birthday'
										| #{value.toISOString().substr(0,10)} (#{contact.age})

									else if key === 'address' && value
										a(
											href=contact.mapLink
											target='_blank'
										)
											if value.country
												span.country(class=value.countryCode, title=value.country)
													= value.country + ', '
											span
												= value.city ? value.city + ' ' : ''
												= value.zip ? value.zip + ', ' : ''
												= value.street ? value.street + ' ' : ''
												= value.number ? value.number + ' ' : ''
												= value.addition ? value.addition : ''

									else
										=contact[key]
							else
								td
